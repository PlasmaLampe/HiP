<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for javascripts/controller/UserController.js</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="../../prettify.css">

    <link rel="stylesheet" href="../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">javascripts/controller/UserController.js</span></h1>
    <h2>
        
        Statements: <span class="metric">52.73% <small>(29 / 55)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">30% <small>(3 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">33.33% <small>(6 / 18)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">52.73% <small>(29 / 55)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">javascripts/controller/</a> &#187; UserController.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * Created by Jörg Amelunxen on 09.11.14.
 *
 * @class angular_module.controllersModule.UserCtrl
 *
 * This controller stores information about the current users. Furthermore, it can be used to evaluate the role
 * of the currently active user.
 */
controllersModule.controller('UserCtrl', ['$scope','$http', '$attrs', function($scope,$http,$attrs) {
    var that = this;
&nbsp;
    this.debug = false;
&nbsp;
    this.errorObject = {
        content:"Connection Error",
        sender:"System"
    };
&nbsp;
    this.userList   = "unset";          // list stores all users in the system
    this.selectedUser = "";             // stores a selected user in the userList
    this.selectedUserMetadata = "";     // stores the meta data of the selected user
&nbsp;
    this.email      = $attrs.mail;      // email address of the current user
    this.firstname  = $attrs.firstname; // firstname of the current user
    this.role       = "unset";          // role of the current user
    this.admin      = "unset";          // is the user an admin?
    this.master     = "unset";          // is the user a master user?
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if(that.debug)
<span class="cstat-no" title="statement not covered" >        console.log("info UserCtrl: init with email " + this.email);</span>
&nbsp;
    /**
     * Returns true, if the user is a student
     *
     * @returns {boolean}
     */
    this.isStudent = function(){
        return that.role == 'student';
    };
&nbsp;
    /**
     * Returns true, if the user is a supervisor
     *
     * @returns {boolean}
     */
    this.isSupervisor = function(){
        return that.role == 'supervisor';
    };
&nbsp;
    /**
     * Returns true, if the user is an admin
     *
     * @returns {boolean}
     */
    this.isAdmin = function(){
        return that.admin == 'true';
    };
&nbsp;
    /**
     * Returns true, if the user is a master user
     *
     * @returns {boolean}
     */
    this.isMaster = function(){
        return that.master == 'true';
    };
&nbsp;
    /**
     * Fetches the meta data for the given user
     *
     * @param userID        userID of the searched user
     * @param callback      callback function that contains the data object as a first parameter
     */
    this.getMetaData = function(userID, callback){
        $http.get('/admin/role/'+userID).
            success(<span class="fstat-no" title="function not covered" >function(data) {</span>
<span class="cstat-no" title="statement not covered" >                var returnObj = {</span>
                    role:   data[0].role,
                    master: data[0].master,
                    admin:  data[0].admin
                };
&nbsp;
<span class="cstat-no" title="statement not covered" >                callback(returnObj);</span>
            }).
            error(<span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >                console.log("Error getting metadata of the user")</span>
            });
    };
&nbsp;
    /**
     * This function updates the meta data for the currently selected user
     */
    this.updateMetadataForSelectedUser = <span class="fstat-no" title="function not covered" >function(){</span>
<span class="cstat-no" title="statement not covered" >        that.getMetaData(that.selectedUser.userid, <span class="fstat-no" title="function not covered" >function(meta){</span></span>
<span class="cstat-no" title="statement not covered" >            meta.admin  = (meta.admin === 'true');</span>
<span class="cstat-no" title="statement not covered" >            meta.master = (meta.master === 'true');</span>
<span class="cstat-no" title="statement not covered" >            that.selectedUserMetadata = meta;</span>
        })
    };
&nbsp;
    /**
     * Updates the currently stored user
     */
    this.updateUser = <span class="fstat-no" title="function not covered" >function(){</span>
<span class="cstat-no" title="statement not covered" >        var metadata = {</span>
            userid :    that.selectedUser.userid,
            email :     that.selectedUser.userid,
            role  :     that.selectedUserMetadata.role,
            templates:  '',
            admin:      that.selectedUserMetadata.admin+'',
            master:     that.selectedUserMetadata.master+''
        };
&nbsp;
        // post
<span class="cstat-no" title="statement not covered" >        $http.put('/admin/roles', metadata).</span>
            success(<span class="fstat-no" title="function not covered" >function() {</span>
                // this callback will be called asynchronously
                // when the response is available
            }).
            error(<span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >                console.log("Error RoleCtrl: Could not update a metadata");</span>
            });
    };
&nbsp;
    /**
     * Fetches the role of the current user if needed (a.k.a, on init)
     */
    <span class="missing-if-branch" title="else path not taken" >E</span>if(that.role == 'unset'){
        that.getMetaData(that.email, <span class="fstat-no" title="function not covered" >function(returnData){</span>
<span class="cstat-no" title="statement not covered" >            that.role   = returnData.role;</span>
<span class="cstat-no" title="statement not covered" >            that.admin  = returnData.admin;</span>
<span class="cstat-no" title="statement not covered" >            that.master = returnData.master;</span>
        });
    }
&nbsp;
    /**
     * Fetches the list of all users if needed (a.k.a, on init)
     */
    <span class="missing-if-branch" title="else path not taken" >E</span>if(that.userList == 'unset'){
        $http.get('/admin/users').
            success(<span class="fstat-no" title="function not covered" >function(data) {</span>
<span class="cstat-no" title="statement not covered" >                that.userList = data;</span>
&nbsp;
                /* use the data to update the lastname value */
<span class="cstat-no" title="statement not covered" >                that.userList.forEach(<span class="fstat-no" title="function not covered" >function(u){</span></span>
<span class="cstat-no" title="statement not covered" >                    if(u.email == that.email){</span>
<span class="cstat-no" title="statement not covered" >                        that.lastname = u.lastname;</span>
                    }
                });
&nbsp;
                /* drop doubles */
<span class="cstat-no" title="statement not covered" >                var found = [];</span>
<span class="cstat-no" title="statement not covered" >                var newUserList = [];</span>
<span class="cstat-no" title="statement not covered" >                that.userList.forEach(<span class="fstat-no" title="function not covered" >function(u){</span></span>
<span class="cstat-no" title="statement not covered" >                    if(jQuery.inArray(u.email, found) == -1){</span>
                        /* not yet included in cleaned user list */
<span class="cstat-no" title="statement not covered" >                        found.push(u.email);</span>
<span class="cstat-no" title="statement not covered" >                        newUserList.push(u);</span>
                    }
                });
&nbsp;
<span class="cstat-no" title="statement not covered" >                that.userList = newUserList;</span>
            }).
            error(<span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >                console.log("Error getting user information")</span>
            });
    }
}]);</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Apr 08 2015 15:32:57 GMT+0200 (CEST)</div>
</div>

<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>

<script src="../../sorter.js"></script>
</body>
</html>
